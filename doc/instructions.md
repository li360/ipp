**你是 Rust、命令行工具开发和网络编程领域的专家。**

### **目标：**

开发一个名为 IPP（IP 地址处理工具）的命令行工具，支持以下功能：

1. 解析多种格式的 IP 地址输入（单 IP、CIDR 子网、IP 范围）。
2. 生成并输出 IP 地址清单。
3. 支持对生成的 IP 地址进行批量 ping 测试，并显示连通性结果。
4. 提供丰富的命令行参数，包括输出限制、帮助信息、版本信息等。

### **核心功能：**

#### **1. 无参数运行：**

- 无参数实现最常用的功能，即：
- 获取当前机器的 IP 地址。
- 输出与该 IP 地址同网段的并且可以 ping 通的 IP 清单（不包括网络地址和广播地址）。
- 默认会对所有 IP 地址进行 ping 测试，但仅显示可以连通的 IP 清单。
- 示例：

  ```bash
  # 命令
  ipp

  # 假设当前机器IP为192.168.0.50，则输出可能是
  192.168.0.50 time<1ms
  192.168.0.51 time=2ms
  ...
  192.168.0.254 time=2ms
  ```

#### **2. CIDR 子网输入：**

- 解析 CIDR 格式的子网（如 `192.168.0.0/24`）。
- 输出该子网内的 IP 清单。
- 支持 `--all` 或 `-a` 参数，包含所有 IP 地址（包括 ping 通并使用绿色显示，和没有 ping 通的所有地址）。
- 示例：

  ```bash
  # 命令
  ipp 192.168.0.0/24

  # 输出
  192.168.0.10 time<1ms
  192.168.0.12 time=1ms
  ...
  192.168.0.201 time=2ms
  ```

  ```bash
  # 命令
  ipp 192.168.0.0/24 --all

  # 输出
  192.168.0.1 time<1ms
  192.168.0.2 time=1ms
  192.168.0.3 timeout
  192.168.0.4 timeout
  ...
  192.168.0.253 timeout
  192.168.0.254 time=2ms
  ```

#### **3. IP 范围输入：**

- 解析 IP 范围（如 `192.168.0.100-103` 或跨子网的 `192.168.0.100-192.168.1.103`）。
- 输出该范围内的所有 IP 地址。
- 示例：

  ```bash
  # 命令
  ipp 192.168.0.100-103

  # 输出
  192.168.0.100 time<1ms
  192.168.0.101 time=2ms
  192.168.0.102 timeout
  192.168.0.103 time=2ms
  ```

#### **4. 输出限制：**

- 支持 `--max` 或 `-m` 参数，限制输出的 IP 地址数量。
- 默认限制为 1000 个 IP 地址。
- 示例：

  ```bash
  # 命令（限制输出最多50个IP地址）
  ipp 192.168.0.0/24 --max 50

  # 或者使用单字母参数
  ipp 192.168.0.0/24 -m 50
  ```

#### **5. 仅输出地址：**

- 支持 `-l` 或 `--list` 参数，不进行 ping 测试，仅输出 IP 地址清单

  ```bash
  # 命令
  ipp -l

  # 假设当前机器IP为192.168.0.50，则输出可能是
  192.168.0.1
  192.168.0.2
  ...
  192.168.0.49
  192.168.0.50
  192.168.0.51
  ...
  192.168.0.254
  ```

### **实现指南：**

#### **1. CLI 设置：**

- 使用 `clap` 定义命令行界面。
- 支持的参数：
  - `--max` 或 `-m`：限制输出的 IP 地址数量。
  - `--ping` 或 `-p`：对生成的 IP 地址进行 ping 测试。
  - `--help` 或 `-h`：显示帮助信息。
  - `--version` 或 `-v`：显示版本信息。

### **测试：**

- 编写单元测试验证 IP 地址生成逻辑。
- 使用 `tokio::test` 测试异步 ping 功能。
- 测试边缘情况（如无效输入、跨子网范围）。

### **交付内容：**

1. 一个功能完善的 IPP 命令行工具。
2. 清晰的文档和示例。
3. 支持多种输入格式和输出限制。
4. 高效的并发 ping 测试功能。

如果有任何问题或需要进一步帮助，请随时告诉我！
